(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{243:function(e,t,n){},249:function(e,t,n){"use strict";n.r(t);var r,c=n(0),a=n.n(c),s=n(31),u=n.n(s),o=n(27),i=n(35),l=n(13),j=n.n(l),d=n(21),b=n(49),f=n(46),p=n.n(f),O="/api/blogs",h=null,x={getAll:function(){var e=Object(d.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get(O);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),create:function(){var e=Object(d.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:h}},e.next=3,p.a.post(O,t,n);case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),setToken:function(e){h="bearer ".concat(e)},update:function(){var e=Object(d.a)(j.a.mark((function e(t){var n,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:h}},e.next=3,p.a.put("".concat(O,"/").concat(t.id),t,n);case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),remove:function(){var e=Object(d.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:h}},e.next=3,p.a.delete("".concat(O,"/").concat(t),n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),addComment:function(){var e=Object(d.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.put("".concat(O,"/").concat(t.id,"/comments"),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},v=function(e){return function(){var t=Object(d.a)(j.a.mark((function t(n){var r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.create(e);case 2:r=t.sent,n({type:"NEW_BLOG",data:r});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},m=function(){return function(){var e=Object(d.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.getAll();case 2:n=e.sent,t({type:"INIT_BLOGS",data:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},g=function(e){return function(){var t=Object(d.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.remove(e.id);case 2:n({type:"DELETE_BLOG",deletedBlog:e});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},y=function(e,t){return function(){var n=Object(d.a)(j.a.mark((function n(r){var c;return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x.addComment(Object(b.a)(Object(b.a)({},e),{},{comments:e.comments.concat(t)}));case 2:c=n.sent,console.log(e),console.log(c),r({type:"UPDATE",payload:Object(b.a)(Object(b.a)({},c),{},{user:e.user})});case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"NEW_BLOG":return e.concat(t.data);case"INIT_BLOGS":return t.data;case"UPDATE":var n=t.payload;return e.map((function(e){return e.id!==n.id?e:n}));case"DELETE_BLOG":var r=t.deletedBlog;return e.filter((function(e){return e.id!==r.id}));default:return e}},k=n(28),I=n(6),T=function(){var e=Object(o.b)(),t=Object(k.f)(),n=Object(o.c)((function(e){return e.user})),r=Object(k.g)().id;Object(c.useEffect)((function(){e(m()),console.log("dispatched")}),[]);var a=Object(o.c)((function(e){return e.blogs})).find((function(e){return e.id===r})),s=Object(o.c)((function(e){return e.users}));if(console.log(a),console.log(s),!a)return null;var u=function(){var t=Object(c.useState)(""),n=Object(i.a)(t,2),r=n[0],s=n[1],u=a.comments,o=function(){var t=Object(d.a)(j.a.mark((function t(n){return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log(u),n.preventDefault();try{e(y(a,r)),s("")}catch(c){console.log(c)}case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(I.jsxs)("div",{children:[Object(I.jsxs)("form",{onSubmit:o,children:[Object(I.jsx)("input",{placeholder:"Add Comment",value:r,onChange:function(e){var t=e.target;s(t.value)}}),Object(I.jsx)("button",{type:"submit",children:"Add"})]}),Object(I.jsx)("div",{children:u?Object(I.jsx)("ul",{children:u.map((function(e){return Object(I.jsx)("li",{children:e},e)}))}):null})]})},l={backgroundColor:"#f44336",color:"white"},f=function(){return n&&a.user.username===n.username?Object(I.jsx)("button",{style:l,onClick:p,children:"Delete"}):null},p=function(){var n=Object(d.a)(j.a.mark((function n(){return j.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:window.confirm("Delete ".concat(a.title," by ").concat(a.author))&&(e(g(a)),t.push("/"));case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return Object(I.jsxs)("div",{className:"blog",children:[Object(I.jsx)("h2",{children:a.title}),Object(I.jsxs)("div",{className:"bloginfo",children:[Object(I.jsx)("a",{href:a.url,children:a.url}),Object(I.jsxs)("p",{className:"likes",children:[a.likes," likes",Object(I.jsx)("button",{onClick:function(){return e(function(e){return function(){var t=Object(d.a)(j.a.mark((function t(n){var r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,x.update(Object(b.a)(Object(b.a)({},e),{},{likes:e.likes+1}));case 2:r=t.sent,console.log(e),console.log(r),n({type:"UPDATE",payload:Object(b.a)(Object(b.a)({},r),{},{user:e.user})});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(a))},children:"like"})]}),Object(I.jsxs)("p",{children:["Added by ",a.author," (",a.user.username,")"]}),Object(I.jsx)(f,{})]}),Object(I.jsx)(u,{})]})},L={login:function(){var e=Object(d.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post("/api/login",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},S=function(e){return function(){var t=Object(d.a)(j.a.mark((function t(n){var r;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,L.login(e);case 2:r=t.sent,n({type:"LOGIN",payload:r});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return t.payload;case"LOGOUT":return null;case"AUTOLOGIN":return t.payload;default:return e}},A=function(e){return function(t){clearTimeout(r),t({type:"new",message:e}),r=setTimeout((function(){t({type:"new",message:""})}),5e3)}},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"new":return t.message;default:return e}},E=n(253),U=n(256),B=n(74),G=function(){var e=Object(c.useState)(""),t=Object(i.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(""),s=Object(i.a)(a,2),u=s[0],l=s[1],b=Object(o.b)(),f=function(){var e=Object(d.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{b(S({username:n,password:u})),r(""),l("")}catch(t){console.log(t),b(A("Wrong credentials")),setTimeout((function(){b(A(null))}),5e3)}case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(I.jsxs)(E.a,{onFinish:f,children:[Object(I.jsx)(E.a.Item,{label:"Username",name:"username",rules:[{required:!0,message:"Please input your username!"}],children:Object(I.jsx)(U.a,{value:n,id:"username",name:"username",onChange:function(e){var t=e.target;return r(t.value)}})}),Object(I.jsx)(E.a.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"}],children:Object(I.jsx)(U.a.Password,{value:u,id:"password",name:"password",onChange:function(e){var t=e.target;return l(t.value)}})}),Object(I.jsx)(E.a.Item,{children:Object(I.jsx)(B.a,{type:"primary",htmlType:"submit",children:"Submit"})})]})},D="/api/users",P={getAll:function(){var e=Object(d.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get(D);case 2:return t=e.sent,console.log(t),e.abrupt("return",t.data);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getUser:function(){var e=Object(d.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.get("".concat(D,"/").concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},z=function(){return function(){var e=Object(d.a)(j.a.mark((function e(t){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.getAll();case 2:n=e.sent,console.log(n),t({type:"getAll",payload:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"getAll":return t.payload;default:return e}},H=n(45),R=function(){var e=Object(o.b)();Object(c.useEffect)((function(){e(z())}),[]);var t=Object(o.c)((function(e){return e.users}));return console.log(t),Object(I.jsxs)("div",{children:[Object(I.jsx)("h3",{children:"Users"}),Object(I.jsxs)("table",{children:[Object(I.jsx)("thead",{children:Object(I.jsxs)("tr",{children:[Object(I.jsx)("th",{children:"User"}),Object(I.jsx)("th",{children:Object(I.jsx)("strong",{children:"Blogs Created"})})]})}),Object(I.jsx)("tbody",{children:t.map((function(e){return Object(I.jsxs)("tr",{children:[Object(I.jsx)("td",{children:Object(I.jsx)(H.b,{to:"/users/".concat(e.id),children:e.name})}),Object(I.jsx)("td",{children:e.blogs.length})]},e.id)}))})]})]})},J=function(){var e=Object(k.g)().id,t=Object(o.b)();Object(c.useEffect)((function(){t(z())}),[]);var n=Object(o.c)((function(e){return e.users})).find((function(t){return t.id===e}));return n?Object(I.jsxs)("div",{children:[Object(I.jsx)("h3",{children:n.name}),n.blogs?Object(I.jsxs)("div",{children:[Object(I.jsx)("h4",{children:"Added blogs"}),Object(I.jsx)("ul",{children:n.blogs.map((function(e){return Object(I.jsx)("li",{children:e.title},e.id)}))})]}):Object(I.jsxs)("p",{children:["No blogs written by ",n.name]})]}):null},M=function(){var e=Object(o.c)((function(e){return e.notification}));if(!e)return null;return Object(I.jsx)("div",{style:{backgroundColor:"#bbebed",padding:"10px"},children:e})},W=function(e){var t=e.blogFormRef,n=Object(c.useState)(""),r=Object(i.a)(n,2),a=r[0],s=r[1],u=Object(c.useState)(""),l=Object(i.a)(u,2),b=l[0],f=l[1],p=Object(c.useState)(""),O=Object(i.a)(p,2),h=O[0],x=O[1],m=Object(o.b)(),g=function(){var e=Object(d.a)(j.a.mark((function e(n){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault();try{t.current.toggleVisibility(),m(v({title:a,author:b,url:h})),s(""),f(""),x(""),m(A("New Blog: ".concat(a," by ").concat(b))),setTimeout((function(){m(A(null))}),5e3)}catch(r){console.log(r),m(A("Please provide all fields")),setTimeout((function(){m(A(null))}),5e3)}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(I.jsxs)("div",{children:[Object(I.jsx)("h2",{children:"Create New Blog"}),Object(I.jsxs)("form",{onSubmit:g,children:[Object(I.jsxs)("div",{children:["Title:",Object(I.jsx)("input",{value:a,onChange:function(e){var t=e.target;s(t.value)},name:"title"})]})," ",Object(I.jsx)("br",{}),Object(I.jsxs)("div",{children:["Author:",Object(I.jsx)("input",{value:b,onChange:function(e){var t=e.target;f(t.value)},name:"title"})]})," ",Object(I.jsx)("br",{}),Object(I.jsxs)("div",{children:["Url:",Object(I.jsx)("input",{value:h,onChange:function(e){var t=e.target;x(t.value)},name:"title"})]})," ",Object(I.jsx)("br",{}),Object(I.jsx)(B.a,{htmlType:"submit",children:"Add"})]})]})},F=a.a.forwardRef((function(e,t){var n=Object(c.useState)(!1),r=Object(i.a)(n,2),a=r[0],s=r[1],u={display:a?"none":"",paddingLeft:"10px"},o={display:a?"":"none"},l=function(){s(!a)};return Object(c.useImperativeHandle)(t,(function(){return{toggleVisibility:l}})),Object(I.jsxs)("div",{children:[Object(I.jsx)("div",{style:u,children:Object(I.jsx)(B.a,{type:"primary",onClick:l,children:e.buttonLabel})}),Object(I.jsxs)("div",{style:o,children:[e.children,Object(I.jsx)(B.a,{type:"primary",onClick:l,children:e.cancelLabel||"cancel"})]})]})}));F.displayName="Togglable";var q=F,K=(n(242),n(251)),V=n(110),Q=n(255),X=n(254),Y=n(252),Z=(n(243),K.a.Header),$=K.a.Content,ee=function(){var e=Object(o.b)(),t=Object(o.c)((function(e){return e.user})),n=Object(c.useState)(null),r=Object(i.a)(n,2),a=r[0],s=r[1],u=Object(c.useRef)();Object(c.useEffect)((function(){e(m())}),[]);var l=Object(o.c)((function(e){return e.blogs}));Object(c.useEffect)((function(){var t=window.localStorage.getItem("loggedUser");if(t){var n=JSON.parse(t);e(function(e){return{type:"AUTOLOGIN",payload:e}}(n)),x.setToken(n.token)}}),[]),Object(c.useEffect)((function(){t&&(window.localStorage.setItem("loggedUser",JSON.stringify(t)),x.setToken(t.token))}),[t]);var j={padding:5};return Object(I.jsxs)("div",{children:[Object(I.jsx)(M,{errorMessage:a}),Object(I.jsx)(K.a,{className:"layout",children:Object(I.jsxs)(H.a,{children:[Object(I.jsx)(Z,{children:null===t?Object(I.jsxs)(V.a,{theme:"dark",mode:"horizontal",defaultSelectedKeys:["home"],children:[Object(I.jsx)(V.a.Item,{children:Object(I.jsx)(H.b,{style:j,to:"/",children:"Home"})},"home"),Object(I.jsx)(V.a.Item,{children:Object(I.jsx)(H.b,{style:j,to:"/users",children:"Users"})},"users")]}):Object(I.jsxs)(V.a,{theme:"dark",mode:"horizontal",defaultSelectedKeys:["home"],children:[Object(I.jsx)(V.a.Item,{children:Object(I.jsx)(H.b,{style:j,to:"/",children:"Home"})},"home"),Object(I.jsx)(V.a.Item,{children:Object(I.jsx)(H.b,{style:j,to:"/users",children:"Users"})},"users"),Object(I.jsxs)("span",{className:"loggedIn",children:[t.name," logged-in "]}),Object(I.jsx)(V.a.Item,{danger:"true",onClick:function(){e({type:"LOGOUT"}),window.localStorage.removeItem("loggedUser")},children:"Log Out"},"logout")]})}),Object(I.jsx)($,{style:{margin:"24px 16px",padding:24,minHeight:280},children:Object(I.jsxs)(k.c,{children:[Object(I.jsx)(k.a,{path:"/blogs/:id",children:Object(I.jsx)(T,{})}),Object(I.jsx)(k.a,{path:"/users/:id",children:Object(I.jsx)(J,{})}),Object(I.jsx)(k.a,{path:"/users",children:Object(I.jsx)(R,{})}),Object(I.jsxs)(k.a,{path:"/",children:[Object(I.jsx)(Q.a,{className:"site-page-header",title:"Blogs",footer:[t?Object(I.jsx)(q,{buttonLabel:"New blog",ref:u,children:Object(I.jsx)(W,{setErrorMessage:s,blogFormRef:u})}):Object(I.jsx)(q,{buttonLabel:"login",children:Object(I.jsx)(G,{})})]}),",",Object(I.jsx)(X.b,{itemLayout:"horizontal",dataSource:l.sort((function(e,t){return t.likes-e.likes})),renderItem:function(e){return Object(I.jsxs)("div",{children:[Object(I.jsx)(X.b.Item,{style:{backgroundColor:"#87e8de",paddingLeft:"1.4rem"},children:Object(I.jsx)(X.b.Item.Meta,{title:Object(I.jsx)(H.b,{to:"/blogs/".concat(e.id),children:e.title})})}),Object(I.jsx)(Y.a,{})]})}})]})]})})]})})]})},te=n(140),ne=n(79),re=n(141),ce=Object(ne.combineReducers)({blogs:w,notification:C,user:N,users:_}),ae=Object(ne.createStore)(ce,Object(te.composeWithDevTools)(Object(ne.applyMiddleware)(re.a)));u.a.render(Object(I.jsx)(o.a,{store:ae,children:Object(I.jsx)(ee,{})}),document.getElementById("root"))}},[[249,1,2]]]);
//# sourceMappingURL=main.8abfa63b.chunk.js.map